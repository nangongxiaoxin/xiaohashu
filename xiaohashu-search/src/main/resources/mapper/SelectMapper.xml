<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.slilio.xiaohashu.search.domain.mapper.SelectMapper">

    <select id="selectEsNoteIndexData" resultType="map" parameterType="map">
        select n.id, n.title, n.topic_name as topic, n.type, n.img_uris,
        DATE_FORMAT(n.create_time, '%Y-%m-%d %H:%i:%s') AS create_time,
        DATE_FORMAT(n.update_time, '%Y-%m-%d %H:%i:%s') AS update_time,
        u.nickname, u.avatar,
        IFNULL(nc.like_total, 0) as like_total,
        IFNULL(nc.collect_total, 0) as collect_total,
        IFNULL(nc.comment_total, 0) as comment_total
        from t_note n left join t_user u on n.creator_id = u.id
        left join t_note_count nc on n.id = nc.note_id
        where n.visible = 0 and n.`status` = 1
        <if test="noteId != null">
            and n.id = #{noteId} limit 1
        </if>
    </select>

</mapper>
